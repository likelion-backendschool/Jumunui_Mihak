<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
    <form th:action th:object="${cartFormDto}" method="post">

        <img th:src="*{imgUrl}" class="card-img-top" alt="card-grid-image">
        <input type="hidden" name="imgUrl" th:value="${cartFormDto.imgUrl}"/>
        <h3>장바구니 속성</h3>
        <hr/>
        <h5 th:text="*{name}" class="card-title">메뉴명</h5>
        <input type="hidden" name="name" th:value="${cartFormDto.name}"/>
        <h5 th:text="*{description}" class="card-title">상세보기</h5>
        <input type="hidden" th:name="description" th:value="${cartFormDto.description}"/>
        <h5 th:text="*{price} +'원'" class="card-title">가격</h5>
        <input type="hidden" th:name="price" th:value="${cartFormDto.price}" />

        <div th:each="optionGroup : *{optionGroups}" class="form-check">
            <h5 th:text="${optionGroup.name}">옵션그룹이름</h5>
            <hr/>
            <div th:if="${optionGroup.isMultiple}">
                <div th:each="optionAndOptionGroup : ${optionGroup.optionAndOptionGroups}">
                    <input type = "checkbox" th:field="*{checkOptions}" th:id="${optionAndOptionGroup.option.getId()}"
                           th:value="${optionAndOptionGroup.option.getId()}" th:checked="${#lists.contains(cartFormDto.checkOptions, optionAndOptionGroup.option)}">
                    <label th:for="${optionAndOptionGroup.option.Id}" th:text="${optionAndOptionGroup.option.name}">옵션이름</label>
                    <span th:text="${optionAndOptionGroup.option.price} +'원'">옵션가격</span>
                </div>
            </div>
            <div th:if="${!optionGroup.isMultiple}">
                <div th:each="optionAndOptionGroup : ${optionGroup.optionAndOptionGroups}" class="form-check form-check-inline">
                    <input type="checkbox" th:class="isNotMultipleCheckbox+${optionAndOptionGroup.optionGroup.getId()}" th:field="*{checkOptions}" th:id="${optionAndOptionGroup.option.getId()}"
                           th:value="${optionAndOptionGroup.option.getId()}" >
                    <label th:for="${optionAndOptionGroup.option.Id}" th:text="${optionAndOptionGroup.option.name}">옵션이름</label>
                </div>
                <script type="text/javascript">
                    /*<![CDATA[*/
                    $(".isNotMultipleCheckbox[[${optionGroup.getId()}]]").on('change', function() {
                        $(".isNotMultipleCheckbox[[${optionGroup.getId()}]]").not(this).prop('checked', false);
                    });
                    /*]]>*/
                </script>
                </div>
            <br/><br/><br/>
        </div>
        <div>
            <div class="container">
                <div class="row mb-8 justify-content-center ">
                    <div class="col-md-6 col-12">
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <p class="text-dark">개수</p>
                                    </div>
                                    <div class="row count mx-2">
                                        <input class=" button-gray button-outline float-right btn-sm my-2 mx-1 col" type='button'
                                               th:onclick='countValue("minus")'
                                               value='-'/>
                                        <div class="col" id='result' th:text="*{count}">0</div>
                                        <input class=" button-gray button-outline float-right btn-sm my-2 mx-1 col" type='button'
                                               th:onclick='countValue("plus")'
                                               value='+'/>
                                    </div>
                                    <!-- div로는 개수 값만 띄워주고 실제로 모델에 넘겨주는 값은 hidden처리-->
                                    <input type="hidden" th:field="*{count}" value="">
                                </div>
                                <script>
                                    function countValue(type)  {
                                        // 결과를 표시할 element
                                        const resultElement = document.getElementById('result');

                                        // 현재 화면에 표시된 값
                                        let number = resultElement.innerText;
                                        // 더하기/빼기
                                        if(type === 'plus') {
                                            if(number != '10'){
                                                number = parseInt(number) + 1;
                                            }
                                        }else if(type === 'minus')  {
                                            if(number != '0'){
                                                number = parseInt(number) - 1;
                                            }
                                        }
                                        // 결과 출력
                                        resultElement.innerText = number;
                                    }

                                    function change_go2() {

                                        var getCount = document.getElementById('result').innerHTML;
                                        console.log(getCount);
                                        document.getElementById("count").value = getCount;

                                    }
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button type="submit" class="float-end btn btn-info btn-sm my-2" th:onclick="change_go2()">메뉴 수정</button>
    </form>
</div>
</html>