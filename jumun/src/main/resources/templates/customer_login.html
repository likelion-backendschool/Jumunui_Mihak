<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>사용자 로그인</title>
    <link rel="stylesheet" href="/resources/static/style.css">
    <script
            src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous"></script>
</head>
<body>

<div class="wrapper">
<form id="join_form" method="post">
    <div class="wrap">
        <div class="subject">
            <span>회원가입</span>
    </div>
        <div class ="id_wrap">
            <div class="id_name">닉네임 입력</div>
            <div class="id_input_box">
                <input class="id_input" name="customerId" placeholder="닉네임을 입력해주세요.">
            </div>
            <span class ="id_input_re_1">사용 가능한 닉네임입니다.</span>
            <span class ="id_input_re_2">이미 존재하는 닉네임입니다.</span>
            <span class="final_id_ck">닉네임 입력은 필수입니다.</span>
        </div>
        <div class="join_button_wrap">
            <input type="button" class="join_button" value="완료">
        </div>
    </div>
</form>
</div>

    <script>
        /* 유효성 검사 통과유무 변수 */
        var idCheck = false;			// 아이디
        var idckCheck = false;             // 아이디 중복검사

        // javascript
        $(document).ready(function(){
            //회원가입 버튼(회원가입 기능 작동)
            $(".join_button").click(function(){

                /* 입력값 변수 */
                var id = $('.id_input').val(); 				// id 입력란

                /* 아이디 유효성검사 */
                if(id == ""){ //공란 시 메시지 출력
                    $('.final_id_ck').css('display','block');
                    idCheck = false;
                }else{
                    $('.final_id_ck').css('display', 'none');
                    idCheck = true;
                }

                /* 최종 유효성 검사 */
                if(idCheck&&idckCheck ){
                    $("#join_form").attr("action", "/customer");
                    $("#join_form").submit();

                }

                return false;
            });
        });
        //아이디 중복검사
        $('.id_input').on("propertychange change keyup paste input", function(){
            /* console.log("keyup 테스트"); */

            var customerId = $('.id_input').val();			// .id_input에 입력되는 값
            var data = {customerId : customerId}				// '컨트롤러에 넘길 데이터 이름' : '데이터(.id_input에 입력되는 값)'

            $.ajax({
                type : "post",
                url : "/customer/customerIdChk",
                data : data,
                success : function(result){
                    // console.log("성공 여부" + result);
                    if(result != 'fail'){
                        $('.id_input_re_1').css("display","inline-block");
                        $('.id_input_re_2').css("display", "none");
                        idckCheck = true;
                    } else {
                        $('.id_input_re_2').css("display","inline-block");
                        $('.id_input_re_1').css("display", "none");
                        idckCheck = false;
                    }
                }// success 종료
            }); // ajax 종료
        });// function 종료
    </script>
</body>
</html>